
trigger:
- master

pool: 'Linux'

variables:
  imageName: 'barathece91/demo-azure-docker'

stages:
- stage: Build
  jobs:
  - job: Build Source Code
    timeoutInMinutes: 3
    steps:
    - script: ./mvwn clean package -U
      
- stage: Unit Test
  jobs:
  - job: Unit Test Code
    timeoutInMinutes: 3
    steps:
    - script: ./mvwn test
- stage: Unit Test
  jobs:
  - job: Unit Test Code
    timeoutInMinutes: 3
    steps:
    - script: ./mvwn test
- stage: Code Quality
  jobs:
  - job:  Code Quality
    timeoutInMinutes: 3
    steps:
    - bash: ./mvwn sonar:sonar
- stage: Docker Build & Docker Push
  jobs:
  - job: Docker build & Push
    timeoutInMinutes: 3
    steps:
    - task: Docker@2
      inputs:
        command: login
        containerRegistry: dockerRegistryServiceConnection2
    - task: Docker@2
      displayName: Build and Push
      inputs:
       command: buildAndPush
       repository: $(imageName)
       tags: |
        v1
        latest

